# -*- mode: ruby -*-
# -*- encoding: utf-8 -*-

Packager.build do
  target do
    platform 'ubuntu'
    version '12.04'
    package 'deb'
    arch 'amd64'
  end
  dependencies do
    runtime ['ruby-interpreter']
  end
  build do
    name 'fission'
    template :generic
    dependencies do
      build [
        'libpq-dev'
      ]
      runtime [
        'libpq',
        'ruby-interpreter'
      ]
    end
    commands do
      build [
        'mkdir -p $PKG_DIR/opt/fission/bin',
        'PATH=$PATH:/opt/chef/embedded/bin gem install --no-ri --no-rdoc bundler',
        'PATH=$PATH:/opt/chef/embedded/bin bundle install --gemfile=gemfiles/fission-complete --path $PKG_DIR/opt/fission/vendor',
        'cp scripts/runner $PKG_DIR/opt/fission/bin/fission',
        'chmod 0755 $PKG_DIR/opt/fission/bin/fission'
      ]
    end
  end
end
